---
title: 一、Nginx概述
date: 2021-05-24 10:59:00
tags:
  - 概述
  - 面试知识点
categories:  
  - 服务器配置与管理
  - Nginx
---

# 是什么？

`Nginx`是 HTTP 服务器和反向代理服务器，邮件代理服务器，以及 Igor Sysoev 最初编写的通用 TCP/UDP 代理服务器

# 常用功能

## Http正向/反向代理

web服务器最常用的功能之一，尤其是反向代理

Nginx在做反向代理时，提供性能稳定，并且能够提供配置灵活的转发功能。Nginx可以根据不同的正则匹配，采取不同的转发策略，比如图片文件结尾的走文件服务器，动态页面走web服务器，只要你正则写的没问题，又有相对应的服务器解决方案，你就可以随心所欲的玩。并且Nginx对返回结果进行错误页跳转，异常判断等。如果被分发的服务器存在异常，他可以将请求重新转发给另外一台服务器，然后自动去除异常服务器

### 正向代理

正向代理类似一个跳板机，代理访问外部资源

比如我们国内访问谷歌，直接访问访问不到，我们可以通过一个正向代理服务器，请求发到代理服，代理服务器能够访问谷歌，这样由代理去谷歌取到返回数据，再返回给我们，这样我们就能访问谷歌了

![img](一、Nginx概述/正向代理.jpg)

**正向代理的作用：**

- 访问原来无法访问的资源，如google

- 可以做缓存，加速访问资源

- 对客户端访问授权，上网进行认证

- 代理可以记录用户访问记录（上网行为管理），对外隐藏用户信息


###  反向代理

反向代理（Reverse Proxy）实际运行方式是指以代理服务器来接受internet上的连接请求，然后将请求转发给内部网络上的服务器，并将从服务器上得到的结果返回给internet上请求连接的客户端，此时代理服务器对外就表现为一个服务器

![img](一、Nginx概述/反向代理.jpg)

 **反向代理的作用：**

- 保证内网的安全，阻止web攻击，大型网站，通常将反向代理作为公网访问地址，Web服务器是内网

- 负载均衡，通过反向代理服务器来优化网站的负载


### 正反向代理的区别

正向代理相对于目标服务器而言<u>隐藏了客户端的IP地址</u>，因为对于目标服务器而言所有请求都是从正向代理服务器发出的，正向代理主要是为了突破网络访问限制，比如科学上网，还有就是隐藏客户端IP地址

反向代理相对于客户端而言<u>隐藏了目标服务器IP地址</u>，只需要知道代理服务器地址就能访问到目标服务器的资源。其主功能是可以做负载均衡和安全防护


## 负载均衡

Nginx提供的负载均衡策略有2种：

- 内置策略：
  - 轮询：每个服务器轮流处理请求
  - 加权轮询：按权重将请求分发
  - Ip hash：对客户端请求的 IP 进行 Hash 操作，然后根据Hash结果将同一个客户端 IP 的请求分发给同一台服务器进行处理，<u>可以解决session不共享的问题</u>
- 扩展策略：各种负载均衡算法

内置策略例：假设有10个请求分别由192.168.1.2、192.168.1.3、192.168.1.4发出，则处理请求的服务器为下表所示

|         | 轮询        | 加权轮询    | Ip hash               |
| ------- | ----------- | ----------- | --------------------- |
| 服务器1 | 1、4、7、10 | 1、7        | 192.168.1.2的全部请求 |
| 服务器2 | 2、5、8     | 2、3、8、9  | 192.168.1.3的全部请求 |
| 服务器3 | 3、6、9     | 4、5、6、10 | 192.168.1.4的全部请求 |


## web缓存

Nginx可以对不同的文件做不同的缓存处理，配置灵活，并且支持FastCGI_Cache，主要用于对FastCGI的动态程序进行缓存。配合着第三方的ngx_cache_purge，对制定的URL缓存内容可以的进行增删管理

# 与Apache服务器的区别

## 区别

**Nginx相对于Apache的优势：**

- 轻量级，采用C进行编写，同样的web服务，会占用更少的内存及资源
- 抗并发，原因见原理篇
- 设计高度模块化，编写模块相对简单，加上社区活跃，各种高性能模块出品迅速
- 配置简洁，正则配置让很多事情变得简单，而且改完配置能使用 -t 测试配置有没有问题
- 一般用于处理静态文件，静态处理性能比apache高三倍以上
- 作为负载均衡服务器，支持7层负载均衡
- 本身就是一个反向代理服务器，而且可以作为非常优秀的邮件代理服务器
- nginx启动特别容易, 并且支持热部署，几乎可以做到 7*24 不间断运行，即使运行数个月也不需要重新启动

**Apache相对于Nginx的优势：**

- apache的rewrite比nginx强大，在rewrite频繁的情况下，用apache
- apache发展到现在，模块超多，基本想到的都可以找到
- apache更为成熟，少bug ，nginx的bug相对较多
- apache超稳定，一个进程死掉时，会影响到多个用户的使用，稳定性差
- apache对PHP支持比较简单，nginx需要配合其他后端用
- apache在处理动态请求有优势，nginx在这方面是鸡肋，一般动态请求要apache去做，nginx适合静态和反向
- apache仍然是目前的主流，拥有丰富的特性，成熟的技术和开发社区

**两者最核心的区别在于：**

Apache是同步多进程模型，一个连接对应一个进程
Nginx是异步的，多个连接（万级别）可以对应一个进程。


## 适用场景

需要性能的web服务，用Nginx；如果不需要性能只求稳定，更考虑Apache；
Nginx处理放静态内容比Apache要好，特别是在可承受压力、带宽及资源消耗上都要优于Apache。
所以更为通用的方案是，前端Nginx抗并发，后端Apache集群，配合起来会更好
